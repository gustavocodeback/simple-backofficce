{"version":3,"sources":["../../src/pages/perfil-usuario/perfil-usuario.module.ts","../../src/pages/perfil-usuario/perfil-usuario.ts","../../src/providers/picture/picture.ts"],"names":[],"mappings":"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","file":"6.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { PerfilUsuarioPage } from './perfil-usuario';\n\n@NgModule({\n  declarations: [\n    PerfilUsuarioPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(PerfilUsuarioPage),\n  ],\n})\nexport class PerfilUsuarioPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/perfil-usuario/perfil-usuario.module.ts","import { PictureProvider } from './../../providers/picture/picture';\nimport { ValidateProvider } from './../../providers/validate/validate';\nimport { FormGroup } from '@angular/forms';\nimport { AuthProvider } from './../../providers/auth/auth';\nimport { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, LoadingController, Events } from 'ionic-angular';\n\n@IonicPage()\n@Component({\n  selector: 'page-perfil-usuario',\n  templateUrl: 'perfil-usuario.html',\n  providers: [ PictureProvider ]\n})\nexport class PerfilUsuarioPage {\n\n  // Usuario\n  public user:any = [];\n\n  // Formulario\n  public profileForm: FormGroup;\n\n  // Validate\n  public validate: ValidateProvider;\n\n  // Tocado\n  public touched = false;\n\n  // Erros\n  public erro = '';\n\n  constructor(public navCtrl: NavController, \n              public navParams: NavParams,\n              public authProvider: AuthProvider,\n              public loadingCtrl: LoadingController,\n              public pictureProvider: PictureProvider,\n              public events: Events) {\n\n    // busca o usuario\n    this.user = this.authProvider.user() ? this.authProvider.user() : [];\n              \n    // Busca a imagem do usuario logado\n    if ( this.user ) this.getImageUserFromApi();\n\n    // Inicializa o formulario\n    this.initForm();\n  }\n\n  initForm() {\n\n    // cria o loading\n    const loading = this.loadingCtrl.create({});\n    loading.present();\n\n    // Inicia um novo validator\n    this.validate = new ValidateProvider();\n\n    // Seta as regras de validação\n    const rules = {\n      name     : '',\n      email    : 'valid_email',\n      password : 'maxLength[18]|minLength[6]|matches[confirm]',\n      confirm  : 'maxLength[18]|minLength[6]|matches[password]'\n    };\n\n    // Seta o formulario\n    this.profileForm = this.validate.set_form( rules );\n    \n    // Tira o loading\n    loading.dismiss();\n  }\n\n  /**\n   * Atualiza as informações do usuario\n   */\n  updateProfile() {\n\n    // Cria o loading\n    const loading = this.loadingCtrl.create({});\n    loading.present();\n\n    // Pega os dados do formulario\n    const dados = JSON.parse( JSON.stringify( this.profileForm.value ) );\n\n    // Busca a foto\n    if( this.user.image && this.touched ) {\n      dados.image = this.user.image;\n    }\n\n    // Atualiza o perfil\n    this.authProvider.updateProfile( dados )\n    .then( user => {\n      \n      this.erro = '';\n      if( user == 'E-mail ja cadastrado no sistema' ) {\n        this.erro = user;\n        return;\n      }\n\n      // Atualiza o usuario e a imagem\n      this.user = user;\n\n      // Imagem\n      this.getImageUserFromApi();\n\n      // Disparo o evento\n      this.events.publish( 'profile' );\n    } )\n    .catch( err => this.erro = err )\n    .then( () => loading.dismiss() );\n  }\n\n  /**\n   * Faz o upload da imagem\n   */\n  getImage() {\n    this.pictureProvider.get()\n    .then( image => {\n      this.user.image = image;\n      this.touched = true;\n    })\n    .catch ( err => console.log( err ) );\n  }\n\n  /**\n   * Busca a imagem do usuario pela api\n   * \n   */\n  getImageUserFromApi() {\n    this.authProvider.getUserImage()\n    .then( image => this.user.image = image )\n    .catch( err => console.log(err) );\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/perfil-usuario/perfil-usuario.ts","import { ActionSheetController  } from 'ionic-angular';\nimport { Camera, CameraOptions } from '@ionic-native/camera';\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class PictureProvider {\n\n  // método contrutor\n  constructor(  public actionSheet: ActionSheetController, \n                public camera: Camera ) {}\n\n  // pega a foto\n  private _getPicture( sourceType ) {\n\n    // define as opcoes da camera\n    const options: CameraOptions = {\n      sourceType,\n      allowEdit: true,\n      targetWidth: 200,\n      targetHeight: 200,\n      quality: 50,\n      destinationType: this.camera.DestinationType.DATA_URL,\n      encodingType: this.camera.EncodingType.JPEG,\n      mediaType: this.camera.MediaType.PICTURE\n    }\n\n    // retorna uma nova promessa\n    return new Promise( ( resolve, reject ) => {\n      this.camera.getPicture( options ).then( pic => {\n        if ( pic ) {\n          resolve( `data:image/jpeg;base64,${pic}` );\n        } else {\n          reject( false );\n        }\n      })\n      .catch( err => { \n        console.log(err);\n        reject( err ); });\n    });\n  }\n\n  // pega uma imagem do usuário\n  public get() : Promise<any> {\n\n    // retorna uma nova promessa\n    return new Promise( ( resolve, reject ) => {\n      \n      const opt: any = {\n        title: 'Foto de perfil',\n        buttons: [ {\n            text: 'Galeria',\n            handler: () => this._getPicture( 0 ).then( pic => resolve( pic ) ).catch( err => reject( err ) )\n        }, {\n            text: 'Câmera',\n            handler: () => this._getPicture( 1 ).then( pic => resolve( pic ) ).catch( err => reject( err ) )\n        }, {\n            text: 'Cancel',\n            role: 'cancel',\n            handler: () => reject( false )\n        }]\n      };\n\n      // define o action sheet\n      const actionSheet = this.actionSheet.create( opt );\n\n      // mostra o action sheet\n      actionSheet.present();\n    });\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/providers/picture/picture.ts"],"sourceRoot":""}